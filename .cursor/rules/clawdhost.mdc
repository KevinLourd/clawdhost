---
description: ClawdHost monorepo guidelines
globs: 
alwaysApply: true
---

# ClawdHost

Managed MoltBot Hosting Platform - "Your AI, always on, always yours"

## Product

ClawdHost provides managed hosting for MoltBot (AI assistant).
- Users pay for a VPS + MoltBot pre-configured
- Web-based onboarding (no terminal required for users)
- Telegram first, then WhatsApp, Discord, iMessage coming soon

## Monorepo Structure

```
clawdhost/
├── apps/
│   ├── web/           # Landing page (clawdhost.tech)
│   ├── onboarding/    # Setup wizard (app.clawdhost.tech)
│   └── worker/        # Provisioning worker (Railway)
└── packages/
    └── shared/        # Shared types
```

## Tech Stack

- **Framework**: Next.js 16, React 19
- **Styling**: Tailwind v4, Shadcn/ui
- **Auth**: Clerk
- **Database**: Neon PostgreSQL
- **Payments**: Stripe
- **Hosting**: Vercel (apps), Railway (worker)
- **VPS Providers**: Hetzner, Scaleway
- **Tunnels**: Cloudflare Tunnel

## Database

Neon Project: clawdhost (sparkling-fog-74915550)
- Production: postgresql://neondb_owner:npg_4CstETVGkZi0@ep-young-rice-a18hjmtu-pooler.ap-southeast-1.aws.neon.tech/neondb?sslmode=require&channel_binding=require

Tables: users, instances, provisioning_logs

Use Neon MCP (project-1-clawdhost-Neon) to verify database state.

## Commands

```bash
pnpm dev              # Run all apps in parallel
pnpm dev:web          # Landing page (port 3000)
pnpm dev:onboarding   # Onboarding wizard (port 3001)
pnpm dev:worker       # Worker
pnpm build            # Build all
```

## Design Guidelines

- Light theme with green primary (#22c55e)
- Reassuring UX: progress indicators, confirmations
- Minimalist, clean, modern
- No terminal jargon visible to end users

## Onboarding Flow

1. Clerk login/signup
2. Plan selection (or pre-selected via URL param)
3. Stripe checkout
4. VPS provisioning (parallel with step 5)
5. User enters: Anthropic API key + Telegram bot token
6. Configure MoltBot via SSH
7. Done → Show Telegram link + terminal access

## Code Style

- Files < 200 lines
- Lazy-init external services (Stripe, Resend) to avoid build-time errors
- Use `getStripe()`, `getResend()` pattern, not module-level instantiation
- Store clerkUserId in DB, not internal IDs

## API Keys Pattern

```typescript
// ❌ Bad - fails at build time without env vars
const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!);

// ✅ Good - only fails at runtime when actually called
function getStripe() {
  if (!process.env.STRIPE_SECRET_KEY) {
    throw new Error("STRIPE_SECRET_KEY is not configured");
  }
  return new Stripe(process.env.STRIPE_SECRET_KEY);
}
```

## MoltBot Integration

MoltBot config lives at `~/.clawdbot/moltbot.json` on the VPS.
Key Gateway RPC methods:
- `config.get`, `config.patch` - read/write config
- `skills.status`, `skills.install` - manage skills
- `sessions.list` - list active sessions

WhatsApp requires QR code scan - handle via terminal or wizard.start WebSocket.
